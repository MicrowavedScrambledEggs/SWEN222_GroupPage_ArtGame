package artGame.ui.renderer;

import java.nio.FloatBuffer;
import java.util.List;

import org.lwjgl.BufferUtils;

import artGame.ui.renderer.math.Matrix4f;
import artGame.ui.renderer.math.Vector2f;
import artGame.ui.renderer.math.Vector3f;
import static org.lwjgl.opengl.GL15.GL_ARRAY_BUFFER;
import static org.lwjgl.opengl.GL15.GL_STATIC_DRAW;
import static org.lwjgl.opengl.GL11.glDrawArrays;
import static org.lwjgl.opengl.GL11.GL_TRIANGLES;

public class Model implements Asset {
	private FloatBuffer vertices;
	private FloatBuffer uvs;
	private VertexArrayObject vao;
	private VertexBufferObject vertBufferObject;
	private VertexBufferObject uvBuffer;
	
	private Matrix4f model;
	
	private Material material;

	public Model(List<Vector3f> verts, List<Vector2f> uvs, List<Vector3f> norms, Matrix4f modelMatrix) {
		model = modelMatrix;
		vao = new VertexArrayObject();
		vao.bind();

		this.vertices = BufferUtils.createFloatBuffer(3 * verts.size());
		for (Vector3f vert : verts) {
			this.vertices.put(vert.getX()).put(vert.getY()).put(vert.getZ());
		}
		this.vertices.flip();
		
		this.uvs = BufferUtils.createFloatBuffer(3 * verts.size());
		for (Vector3f vert : verts) {
			vertices.put(vert.getX()).put(vert.getY()).put(vert.getZ());
		}
		vertices.flip();
		
		vertBufferObject = new VertexBufferObject();
        vertBufferObject.bind(GL_ARRAY_BUFFER);
        vertBufferObject.uploadBufferData(GL_ARRAY_BUFFER, vertices, GL_STATIC_DRAW);
		
		material = new Material(vertBufferObject, uvBuffer);
	}

	@Override
	public void draw(Matrix4f view) {
		material.updateUniforms(model, view);
		glDrawArrays(GL_TRIANGLES, 0, 3);
	}
	
	@Override
	public void delete() {
		vao.delete();
		vertBufferObject.delete();
		uvBuffer.delete();
	}
}
