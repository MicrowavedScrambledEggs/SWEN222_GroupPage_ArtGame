package artGame.ui.renderer.math;

import java.nio.FloatBuffer;

import org.lwjgl.BufferUtils;

public class Matrix4f {
	// stored as (row, col)
	private float[][] m = new float[4][4];

	public Matrix4f() {
		m[0][0] = 1f;
		m[1][0] = 0f;
		m[2][0] = 0f;
		m[3][0] = 0f;

		m[0][1] = 0f;
		m[1][1] = 1f;
		m[2][1] = 0f;
		m[3][1] = 0f;

		m[0][2] = 0f;
		m[1][2] = 0f;
		m[2][2] = 1f;
		m[3][2] = 0f;
		
		m[0][3] = 0f;
		m[1][3] = 0f;
		m[2][3] = 0f;
		m[3][3] = 1f;
	}

	public Matrix4f(Vector4f col1, Vector4f col2, Vector4f col3, Vector4f col4) {
		m[0][0] = col1.getX();
		m[1][0] = col1.getY();
		m[2][0] = col1.getZ();
		m[3][0] = col1.getW();

		m[0][1] = col2.getX();
		m[1][1] = col2.getY();
		m[2][1] = col2.getZ();
		m[3][1] = col2.getW();

		m[0][2] = col3.getX();
		m[1][2] = col3.getY();
		m[2][2] = col3.getZ();
		m[3][2] = col3.getW();
		
		m[0][3] = col4.getX();
		m[1][3] = col4.getY();
		m[2][3] = col4.getZ();
		m[3][3] = col4.getW();
	}

	public Matrix4f add(Matrix4f other) {
		Matrix4f result = new Matrix4f();

		for (int row = 0; row < m.length; row++) {
			for (int col = 0; col < m[row].length; col++) {
				result.m[row][col] = m[row][col] + other.m[row][col];
			}
		}

		return result;
	}

	public Matrix4f multiply(float scalar) {
		Matrix4f result = new Matrix4f();

		for (int row = 0; row < m.length; row++) {
			for (int col = 0; col < m[row].length; col++) {
				result.m[row][col] = m[row][col] * scalar;
			}
		}

		return result;
	}

	public Matrix4f multiply(Matrix4f other) {
		Matrix4f result = new Matrix4f();

		for (int i = 0; i < m.length; i++) {
			for (int j = 0; j < other.m[0].length; j++) {
				for (int k = 0; k < m[0].length; k++) {
					result.m[i][j] += m[i][k] * other.m[k][j];
				}
			}
		}

		return result;
	}

	public Vector4f multiply(Vector4f vector) {
		float[] vectorData = vector.toArray();
		float[] v = new float[vectorData.length];
		for (int i = 0; i < m.length; i++)
			for (int j = 0; j < m[0].length; j++)
				v[i] += m[i][j] * vectorData[j];

		return new Vector4f(v[0], v[1], v[2], v[3]);
	}

	public FloatBuffer toBuffer() {
		FloatBuffer buffer = BufferUtils.createFloatBuffer(4 * 4);
		buffer.put(m[0][0]).put(m[1][0]).put(m[2][0]).put(m[3][0]);
		buffer.put(m[0][1]).put(m[1][1]).put(m[2][1]).put(m[3][1]);
		buffer.put(m[0][2]).put(m[1][2]).put(m[2][2]).put(m[3][2]);
		buffer.put(m[0][3]).put(m[1][3]).put(m[2][3]).put(m[3][3]);
		buffer.flip();
		return buffer;
	}
	
	public static Matrix4f ortho(float left, float right, float bottom, float top, float near, float far) {
        Matrix4f ortho = new Matrix4f();

        float tx = -(right + left) / (right - left);
        float ty = -(top + bottom) / (top - bottom);
        float tz = -(far + near) / (far - near);

        ortho.m[0][0] = 2f / (right - left);
        ortho.m[1][1] = 2f / (top - bottom);
        ortho.m[2][2] = -2f / (far - near);
        ortho.m[0][3] = tx;
        ortho.m[1][3] = ty;
        ortho.m[2][3] = tz;

        return ortho;
    }
	
	public static Matrix4f persp(float left, float right, float bottom, float top, float near, float far) {
        Matrix4f persp = new Matrix4f();

        float a = (right + left) / (right - left);
        float b = (top + bottom) / (top - bottom);
        float c = -(far + near) / (far - near);
        float d = -(2f * far * near) / (far - near);

        persp.m[0][0] = (2f * near) / (right - left);
        persp.m[1][1] = (2f * near) / (top - bottom);
        persp.m[0][2] = a;
        persp.m[1][2] = b;
        persp.m[2][2] = c;
        persp.m[3][2] = -1f;
        persp.m[2][3] = d;
        persp.m[3][3] = 0f;

        return persp;
    }
	
	public static Matrix4f translate(Vector3f delta) {
        Matrix4f trans = new Matrix4f();

        trans.m[0][3] = delta.getX();
        trans.m[1][3] = delta.getY();
        trans.m[2][3] = delta.getZ();

        return trans;
    }
	
	public static Matrix4f rotate(float angle, float x, float y, float z) {
        Matrix4f rotation = new Matrix4f();

        float c = (float) Math.cos(Math.toRadians(angle));
        float s = (float) Math.sin(Math.toRadians(angle));
        Vector3f vec = new Vector3f(x, y, z);
        if (vec.length() != 1f) {
            vec = vec.normalized();
            x = vec.getX();
            y = vec.getY();
            z = vec.getZ();
        }

        rotation.m00 = x * x * (1f - c) + c;
        rotation.m10 = y * x * (1f - c) + z * s;
        rotation.m20 = x * z * (1f - c) - y * s;
        rotation.m01 = x * y * (1f - c) - z * s;
        rotation.m11 = y * y * (1f - c) + c;
        rotation.m21 = y * z * (1f - c) + x * s;
        rotation.m02 = x * z * (1f - c) + y * s;
        rotation.m12 = y * z * (1f - c) - x * s;
        rotation.m22 = z * z * (1f - c) + c;

        return rotation;
    }
}
